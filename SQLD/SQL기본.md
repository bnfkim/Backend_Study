### SQL 문장들의 종류
- 데이터 조작어 (DML : Data Manipulation Language)
  - SELECT (RETRIEVE)
    - 데이터베이스에 들어 있는 데이터를 조회하거나 검색하기 위한 명령어를 말하는 것 
  - INSERT, UPDATE, DELETE 
    - 테이블에 들어 있는 데이터에 변형을 가하는 종류의 명령어들
    - 데이터를 테이블에 새로운 행을 집어넣거나, 원하지 않는 데이터를 수정 혹은 삭제하는 명령어들
- 데이터 정의어 (DDL : Data Definition Language)
  - CREATE, ALTER, DROP, RENAME
    - 테이블과 같은 데이터 구조를 정의하는데 사용되는 명령어들
    - 그러한 구조를 생성하거나 변경하거나 삭제하거나 이름을 바꾸는 데이터 구조와 관련된 명령어들
- 데이터 제어어 (DCL : Data Control Language)
  - GRANT, REVOKE
    - 데이터베이스에 접근하고 객체들을 사용하도록 권한을 주고 회수하는 명령어
- 트랜잭션 제어어 (TCL : Transaction Control Language)
  - COMMIT, ROLLBACK
    - 논리적인 작업의 단위를 묶어서 DML에 의해 조작된 결과를 작업단위 별로 제어하는 명령어 

### 데이터 언어와 SQL 명령어
- 비절차적 데이터 조작어(DML)는 사용자가 무슨(what) 데이터를 원하는지만을 명세한다
- 절차적 데이터 조작어는 어떻게(how) 데이터를 접근해야 하는지 명세한다
- 절차적 데이터 조작어로는 PL/SQL (오라클), T-SQL(SQL Server)가 있다

### PK 설정 명령어
- CREATE TABLE PRODUCT ( CONSTRAINT PRODUCT_PK PRIMARY KEY (PROD_ID) );
- ALTER TABLE PRODUCT ADD CONSTRAINT PRODUCT_PK PRIMARY KEY (PROD_ID);
- ALTER TABLE \[테이블명] ADD CONSTRAINT \[pk 이름] PRIMARY KEY ( \[pk로 쓸 컬럼명])

### 테이블 칼럼에 대한 정의 변경
- 오라클 : ALTER TABLE '테이블 명' MODIFY ( '칼럼명' '데이터 유형' 'default 식' 'NOT NULL, '칼럼명2' ... )
- SQL Server : ALTER TABLE '테이블명' ALTER ( '칼럼명' '데이터 유형' 'default 식' 'NOT NULL, '칼럼명2' ... )

### NULL
- 모르는 값을 의미
- 값의 부재를 의미
- NULL과의 모든 비교는 알 수 없음으로 반환

### 옵션
- REFERENCES '참조할_테이블' '참조할_컬럼' \[ON DELETE CASCADE | ON DELETE SET NULL]
- ON DELETE CASCADE
  - 참조되는 부모 테이블의 행에 대한 DELETE를 허용한다.
  - 부모 테이블의 행이 지워지면 자식 테이블의 행도 같이 지워진다.
- ON DELETE SET NULL
  - 참조되는 부모 테이블의 행에 대한 DELETE를 허용한다.
  - 부모 테이블의 행이 지워지면 자식 테이블의 행은 NULL 값으로 설정된다.

### 제약조건의 종류 (Constraints)
- 데이이터 베이스에서 데이터의 무결성을 유지하기 위하여 테이블의 특정 컬럼에 설정하는 제약
- UNIQUE
  - 고유키, 테이블 내에서 중복되는 값이 없음, NULL 입력 가능
- PK
  - 주키로 테이블당 1개만 생성 가능
- FK
  - 외래키로 테이블 당 여러 개 생성 가능, NULL 입력 가능, 참조 무결성 제약을 받을 수 있음, 테이블 생성 시 설정할 수 있음
- NOT NULL
  - 명시적으로 NULL 입력 방지

### 테이블명과 칼럼명 규칙
- A-Z, a-z, 0-9, _ , $, # 만 허용

### 테이블의 불필요한 칼럼 삭제하는 명령어
- ALTER TABLE '테이블명' DROP COLUMN '삭제할 컬럼명'

#### 참조 무결성에 의한 DELETE ACTION 참조동작
1) cascade : 부모 삭제 시 자식도 같이 삭제
2) set null : 부모 삭제 시 자식 해당 필드 null
3) set default : 부모 삭제 시 자식 해당 필드 디폴트 값으로 설정
4) restrict : 자식 테이블에 PK 값이 없는 경우에만 부모 삭제 허용
5) no action : 참조 무결성을 위반하는 삭제/수정 액션을 취하지 않음

### 참조무결성에 의한 INSERT ACTION 참조동작
1) Automatic : 부모 테이블에 PK가 없는 경우 부모 PK를 생성 후 자식 입력
2) Set Null : 부모 테이블에 PK가 없는 경우 자식 외부키를 null 값으로 처리
3) Set Default : 부모 테이블에 PK가 없는 경우 자식 외부키를 지정된 기본 값으로 입력
4) Dependent : 부모 테이블에 PK가 존재할 때만 자식 입력 허용
5) No Action : 참조 무결성을 위반하는 입력 액션을 취하지 않음

### 테이블 이름 변경하는 방법
- RENAME '기존 테이블 명' TO '바꿀 테이블 명'

### 삭제와 로그
- TRUNCATE TABLE
  - 로그 안 남김 (롤백 불가)
  - 특정 테이블의 모든 데이터 삭제
  - 디스크 사용량 초기화 (테이블을 최초 생성된 초기화 상태로 만듬)
  - 자동 커밋
- DROP TABLE
  - 로그 안 남김 (롤백 불가)
  - 테이블의 데이터 모두 삭제
  - 디스크 사용량 초기화 가능하지만 테이블의 스키마 정의도 함께 삭제 (테이블 정의 자체를 완전히 삭제)
  - 자동커밋
- DELETE FROM
  - 로그 남김 (커밋 이전 롤백 가능)
  - 테이블의 데이터 모두 삭제하지만 디스크 사용량을 초기화 하지는 않음
  - 사용자 커밋

### DISTINCT
- 데이터의 중복을 제거하는 명령어
- GROUP BY문을 사용하여 중복을 제거할 수도 있음

### 데이터베이스 트랜잭션 4가지 특성
1) 원자성 : 트랜잭션에서 정의된 연산들은 모두 성공적으로 실행되던지 아니면 전혀 실행되지 않은 상태로 남아있어야 한다
2) 일관성 : 트랜잭션이 실행 되기 전의 데이터베이스 내용이 잘못되어 있지 않아면 트랜잭션이 실행된 이후에도 데이터베이스의 내용에 잘못이 있으면 안 된다
3) 고립성 : 트랜잭션이 실행되는 도중에 다른 트랜잭션의 영향을 받아 잘못된 결과를 만들어져서는 안 된다
4) 지속성 : 트랜잭션이 성공적으로 수행되면 그 트랜잭션이 갱신한 데이터베이스의 내용은 영구적으로 저장된다

### 트랜잭션에 대한 격리성이 낮은 경우 발생할 수 있는 문제점 4가지
- Dirty Read
  - 다른 트랜잭션에 의해 수정되었지만 아직 커밋되지 않은 데이터를 읽는 것을 말한다
- Non-Repeatable Read
  - 한 트랜잭션 내에서 같은 쿼리를 두 번 수행했는데, 그 사이에 다른 트랜잭션이 값을 수정 또는 삭제하는 바람에 두 쿼리 결과가 다르게 나타나는 형상
- Phantom Read
  - 한 트랜잭션 내에서 같은 쿼리를 두 번 수행했는데, 첫번째 쿼리에서 없던 유령 레코드가 두번째 쿼리에서 나타나는 형상

### 롤백(Rollback)
- 커밋 이전에는 변경 사항을 취소할 수 있다
- 데이터 변경 사항이 취소되어 데이터의 이전 상태로 복구되며 관련된 행에 대한 잠금이 풀리고 다른 사용자들이 데이터 변경을 할 수 있게 된다
- 저장점을 정의하면 롤백할 때 트랜잭션에 포함된 전체 작업을 롤백하는 것이 아니라 현 시점에서 SAVEPOINT 까지 트랜잭션의 일부만 롤백할 수 있다

### ORACLE, SQL Server
- ORACLE에서 DDL 문장의 수행은 내부적으로 트랜잭션을 종료시키므로
- ORACLE 에서는 DDL 문장 수행 후 자동으로 COMMIT을 수행
- SQL Server에서는 DDL 문장 수행 후 자동으로 COMMIT 수행하지 않는다
- SQL Server에서는 CREATE TABLE 문장도 TRANSACTION의 범주에 포함된다.

### **NULL 의미**

NULL은 값이 0이라는 의미가 아니라 데이터의 값이 완전히 '비어있는' 상태

- 값이 존재하지 않음
- 해당 사항 없음
- 노출할 수 없는 값
- 확정되지 않은 값

### ‘’ 의 의미

- ORACLE → `‘’` → NULL
    - `WHERE (칼럼명) IS NULL` 로 입력해야 조회됨
- SQL SERVER → `‘’` → 공집합
    - `WHERE (칼럼명) = ‘’` 로 입력해야 조회됨

### NULL의 연산

- +, -, *, / 연산 → `NULL` 값 리턴
- 비교연산 → `FALSE` 값 리턴

### 부정 비교 연산자

- `!=`
    - 같지 않다
- `^=`
    - 같지 않다
- `<>`
    - 같지 않다
    - ISO 표준, 모든 운영체제에서 사용 가능
- `NOT 칼럼명 =`
    - ~와 같지 않다
- `NOT 칼럼명 >`
    - ~보다 크지 않다

### 논리 연산자의 우선 순위

- NOT > AND > OR

- ORACLE 에서는 ‘’ 가 NULL로 입력된다

### TO_DATE 함수

- **문자를 날짜 데이터 타입으로 변화해 주는 함수**

### 내장함수 (단일행 함수와 다중행 함수)

- 단일행 함수
    - SELECT, WHERE ORDER BY, UPDATE의 SET절에 사용 가능
    - 1:M 조인 시, M쪽에서 출력된 행들이 하나씩 단일행 함수의 입력값으로 사용된
    - 여러 인자를 입력해도 단 하나의 결과만 리턴
    - 특별한 경우가 아니라면 함수의 인자로 함수를 사용하는 함수의 중첩이 가능
- 다중행 함수
    - 집계 함수
    - 그룹 함수
    - 윈도우 함수
- 단일행 함수와 다중행 함수 모두 동일하게 단일 값만 반환한다
- 1:M 조인할 경우, M쪽에 출력된 행이 하나씩 단일행 함수의 입력값으로 사용되므로 단일행 함수도 사용 가능하다

### 단일행 함수

- 문자열 함수
    - 문자를 입력하면 문자나 숫자 값 반환
- 숫자형 함수
    - 숫자를 입력하면 숫자 값을 반환
- 날짜형 함수
    - 날짜 데이터 타입의 값을 연산
- 형변환 함수
    - 두 개의 데이터의 데이터 타입이 일치하도록 변환
- NULL 관련 함수

## 단일행 함수

### 문자열 함수

- ASC II(문자)
    - 문자나 숫자를 아스키 코드번호로 변환
- CHR/CHAR(ASC II)
    - 아스키 코드번호를 문자나 숫자로 변환
- LOWER(), UPPER()
    - 문자열의 알파벳 문자를 소문자, 대문자로 변환
- **CONCAT(문자열1, 문자열2)**
    - 문자열 1과 문자열2를 결합
    - ‘||’ (ORACLE) 나 ‘+’ (SQL Server)를 사용하기도 함
- SUBSTR/SUBSTRING(문자열, m, n)
    - 문자열 중 m위치에서 n개의 문자 길이에 해당하는 문자를 변환
- LENGTH/LEN
    - 문자열의 길이를 숫자값으로 변환
    - 공백이나 줄바꿈도 숫자를 센다
        - `REPLACE(칼럼명, CHR(10))` 를 사용하면 줄바꿈이 제거됨
- LTRIM, RTRIM(문자열, 지정문자)
    - 문자열의 왼쪽,오른쪽부터 확인해서 지정문자가 나타나면 해당 문자 제거
- TRIM([leading | trailing | both] 지정문자 from 문자열)
    - 문자열에서 머리말, 꼬리말 또는 양쪽에 있는 지정문자 제거
    - 생략 시 both 값이 default

### 숫자형 함수

- ABS(숫자)
    - 숫자의 절대값 반환
- SIGN(숫자)
    - 숫자를 양수, 음수, 0으로 구분하여 반환
- MOD(숫자1, 숫자2)
    - 숫자1을 숫자 2로 나누어 나머지 반환
- CEIL/CEILING(숫자)
    - 숫자보다 크거나 같은 최소 정수 반환
- FLOOR(숫자)
    - 숫자보다 작거나 같은 최대 정수 반환
- ROUND(숫자, m)
    - 숫자를 소수점 m 자리에서 반올림하여 반환
- TRUNC(숫자 ,m)
    - 숫자를 소수점 m자리에서 잘라서 버림
- SIN, COS, TAN
    - 숫자의 삼각함수 값을 반환
- EXP(), POWER(), SQRT(),LOG(),LN()
    - 숫자의 지수, 거듭제곱, 제곱근, 자연로그 값 리턴

### 날짜형 함수

- EXTRACT(’YEAR’ | ‘MONTH’ | ‘DAY’ from d)/
    - 날짜 데이터에서 년/월/일 데이터 반환
    - ex> EXTRACT(MONTH FROM DATE ‘2022-12-20’) → 12이 출력
- TO_NUMBER(TO_CHAR(d,’YYYY’))
    - 날짜 데이터에서 ‘년’ 데이터를 반환
- **특정날짜 +1 은 하루를 더한다는 의미**
    - 1/24/60 = 24시간으로 나누고 60분으로 나눔 = 1분 의미
    - 1/24/(60/10) = 괄호연산부터 먼저 → 1/24/6 = 10분 의미

### 형변환 함수

- TO_NUMBER(문자)
    - 문자 데이터 타입을 **숫자 데이터 타입**으로 변환
- TO_CHAR(숫자 혹은 날짜, [format])
    - 숫자 혹은 날짜 데이터 타입을 지정된 format **문자 데이터 타입**으로 변환
- TO_DATE(문자열, format)
    - 문자 데이터 타입을 지정된 format 의 **날짜 데이터 타입**으로 변환

### **NULL 관련 함수**

- `NVL/ISNULL(표현식1, 표현식2)`
    - NULL 값을 다른 값으로 바꾸는 함수
    - 표현식 1의 결과값이 NULL 이면 표현식2의 값을 출력
- `NVL2(표현식1, 표현식2)`
    - NULL 이 아니면 표현식1, NULL 이면 표현식2 반환
- `NULLIF(value1, value2)`
    - 두 개의 값이 같으면 NULL, 같지 않으면 첫 번째 값 반환
- `COALESCE(value1, value2, value3 … )`
    - NULL 이 아닌 최초의 인자 값을 반환
- NULL은 등호(=) 로 표현 불가
    - `IS NULL`, `IS NOT NULL` 로 비교

## 다중행 함수

여러 행들이 묶인 하나의 그룹에 단 하나의 결과를 출력하는 다중행 함수

### 집계함수

- AVG
- COUNT
    - COUNT(*) : **NULL 값을 포함한** 행의 수 출력
    - COUNT(표현식) : **NULL 값을 제외한** 행의 수 출력
- SUM
    - 지정한 열에서 NULL값을 제외한 총합을 반환
- STDDEV/VARIAN
    - 지정한 열의 표준편차, 분산을 출력
- MIN/MAX
    - 지정한 열의 가장 작은, 큰 값을 반환

### 그룹함수

데이터를 그룹화하여 하나의 테이블을 한 번만 읽어서 빠른 작업을 가능하게 하는 다중행 함수

윈도우 함수를 사용해 순위, 합계, 평균, 행 위치 등을 조작 가능

- ROLLUP
    - 지정된 Grouping Columns의 List는 subtotal 생성하기 위해 사용
    - **각 Group 별 합계와 전체 합계**가 출력
        - GROUP BY 함수는 각 group 별 합계만 출력
        - ex> ROLLUP(칼럼명1, 칼럼명2) 입력시 칼럼 1 합계를 칼럼 2합계와 함께 출력
- GROUPING SETS
    - GROUP BY에 나오는 칼럼의 순서와 관계없이 다양한 소계를 만들기 위해 사용
    - 표시된 인수들에 대한 개별 집계를 구할 수 있음
    - GROUP BY **GROUPING SETS(칼럼명, ())** 를 사용하면 "GROUP BY **ROLLUP(칼럼명)**과 동일
        
        → GROUP BY()가 전체 칼럼을 하나의 그룹으로 처리한다는 의미이므로!
